# Authorization
Our general philosophy is that any information that could be obtained through anonymous web-scraping or UI automation should not require authentication. This includes all API requests that retrieve public data (business info, menus) or submit orders.

Authentication is required for API requests that modify public data (change the business phone number, add a menu item, accept an order), or access non-public information (the list of open orders, payment gateway credentials). These requests have a mandatory ```accessToken``` field that's used to verify the user's permissions - the rest of this article deals with this.

## Retrieving access tokens
Access tokens are generated by the Wix Restaurants Authentication service, a JSON-RPC variant with a single endpoint:

    https://auth.wixrestaurants.com/v1.0

Requests are POSTed as JSON objects:

    {"type":"some_request_type", ...}

Successful responses are returned as JSON objects:

    {"value": ...}

Likewise, error responses: 

    {"error":{"code":"some_error_code","message":"some error message"}}

While the service supports various modes of authentication, the recommended flow is to exchange a Wix [App Instance](https://dev.wix.com/docs/infrastructure/app-instance/) with an access token, and use the access token for all subsequent API requests. The generated access token is valid for up to 48 hours, after which it needs to be re-generated from a new Wix App instance.

## Retrieving a Wix App Instance
To retrieve a Wix app instance,

1. Open the Wix editor
2. Double-click on one of the Wix Restaurants apps to open its settings dialog
3. Right click anywhere in this dialog, and choose "View page source"
4. A new tab should open with a URL that looks like ```view-source:https://apps.wixrestaurants.com/...&instance=XXX&...```
5. Note the instance query parameter value (```XXX``` above)

We are aware of how cumbersome this is, and are working on ways to improve the flow.

## Example
The following cURL command generates an access token from a Wix App Instance (```XXX``` in the example):

    curl -X "POST" -H "Content-Type: application/json" -d '{"type":"wix.loginInstance","appKey":"13c1402c-27f2-d4ab-7463-ee7c89e07578","instance":"XXX"}' "https://auth.wixrestaurants.com/v1.0"

The ```appKey``` field specifies which Wix Restaurants app was used to retrieve the Wix App Instance ([possible values](https://github.com/wix/wix-restaurants-java-sdk/blob/master/wix-restaurants-java-client/src/main/java/com/wix/restaurants/WixAppIds.java)).

A successful response returns a [LoginResponse](https://github.com/wix/wix-restaurants-authentication/blob/master/wix-restaurants-authentication-api/src/main/java/com/wix/restaurants/authentication/model/LoginResponse.java) value:

    {"value":{"user":{...},"accessToken":"AAA"}}

```AAA``` can then be used to make privileged API calls for the relevant restaurant.